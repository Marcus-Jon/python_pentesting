import socket
import time
from IPy import IP

# Python network scanner
def port_scan():
    target_machine = input("Enter target machine: ")

    target_ip = socket.gethostbyname(target_machine)

    print("Starting scan on host: |", target_machine, " --- ", target_ip, "|")

    for i in range(0, 1024):
        scanner_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        scanner_connection = scanner_socket.connect_ex((target_ip, i))

        if (scanner_connection == 0):
            print("Port ", i, ": Open")
            scanner_socket.close()

def host_scan():
    network = input("Enter the network and CIDR to scan (format-- x.x.x.x/xx): ")
    ip = IP(network)
    ports = [445, 135]
    for i in ip:
        host_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        socket.setdefaulttimeout(1)
        for x in ports:
            host_connection = host_socket.connect_ex((str(i), x))
            if host_connection == 0:
                print ("Host: ", i, " is live.")
                break
        host_socket.close()

def main():
    print("Python network scanner")
    host_scan()
    port_scan()

if __name__ == '__main__':
    start_time = time.time()
    main()
    print ("Time taken: ", time.time() - start_time)
